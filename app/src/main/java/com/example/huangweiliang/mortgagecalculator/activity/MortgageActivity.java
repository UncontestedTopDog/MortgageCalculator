package com.example.huangweiliang.mortgagecalculator.activity;import android.content.Context;import android.content.Intent;import android.os.SystemClock;import android.support.v7.app.AppCompatActivity;import android.os.Bundle;import android.text.Html;import android.util.Log;import android.view.MotionEvent;import android.view.View;import android.view.inputmethod.InputMethodManager;import android.widget.Button;import android.widget.ImageView;import android.widget.LinearLayout;import android.widget.SeekBar;import android.widget.TextView;//import com.example.huangweiliang.mortgagecalculator.model.Mortgage;import com.example.huangweiliang.mortgagecalculator.R;import com.example.huangweiliang.mortgagecalculator.SharedObjects;import com.example.huangweiliang.mortgagecalculator.listener.IEditTextChangeCallback;import com.example.huangweiliang.mortgagecalculator.listener.ISelectorCallback;import com.example.huangweiliang.mortgagecalculator.model.MorHistoryData;import com.example.huangweiliang.mortgagecalculator.model.MortgageData;import com.example.huangweiliang.mortgagecalculator.model.ResultData;import com.example.huangweiliang.mortgagecalculator.view.PickDialog;import com.example.huangweiliang.mortgagecalculator.view.SelectorView;import com.example.huangweiliang.mortgagecalculator.view.UnitEditText;import com.greendao.gen.MorHistoryDataDao;import java.util.Locale;import static com.example.huangweiliang.mortgagecalculator.model.MortgageData.BASE_COM_RATE;import static com.example.huangweiliang.mortgagecalculator.model.MortgageData.BASE_FUND_RATE;public class MortgageActivity extends BaseActivity{    private SelectorView morTypeSelector;    private SelectorView repayTypeSelector;    private LinearLayout mainLayout;    private UnitEditText comET;    private UnitEditText fundET;    private TextView mortgageTime;    private SeekBar timeSeek;    private Button calculator;    private ImageView history;    private TextView commercialStandardRateView;    private TextView fundStandardRateView;    private MortgageData mortgageData = new MortgageData();    private double comRate = BASE_COM_RATE;    private int comPickItem = 4;    private LinearLayout comRatePicker;    private TextView comRateResult;    private double fundRate = BASE_FUND_RATE;    private int fundPickItem = 4;    private LinearLayout fundRatePicker;    private TextView fundRateResult;    private PickDialog pickDialog;    private ISelectorCallback morCallback = new ISelectorCallback() {        @Override        public void onClickFirst() {            mortgageData.setMorType(MortgageData.MORTGAGE_COMMERCIAL);            comET.setVisibility(View.VISIBLE);            fundET.setVisibility(View.GONE);            fundRatePicker.setClickable(false);            comRatePicker.setClickable(true);        }        @Override        public void onClickSecond() {            mortgageData.setMorType(MortgageData.MORTGAGE_FUND);            comET.setVisibility(View.GONE);            fundET.setVisibility(View.VISIBLE);            fundRatePicker.setClickable(true);            comRatePicker.setClickable(false);        }        @Override        public void onClickThird() {            mortgageData.setMorType(MortgageData.MORTGAGE_COMPOSE);            comET.setVisibility(View.VISIBLE);            fundET.setVisibility(View.VISIBLE);            fundRatePicker.setClickable(true);            comRatePicker.setClickable(true);        }    };    private ISelectorCallback repayCallback = new ISelectorCallback() {        @Override        public void onClickFirst() {            mortgageData.setRepayType(MortgageData.REPAYMENT_AC);        }        @Override        public void onClickSecond() {            mortgageData.setRepayType(MortgageData.REPAYMENT_ACPI);        }    };    private View.OnTouchListener mainTouchListener = new View.OnTouchListener() {        @Override        public boolean onTouch(View view, MotionEvent motionEvent) {            InputMethodManager imm = (InputMethodManager) MortgageActivity.this.getSystemService(Context.INPUT_METHOD_SERVICE);            imm.hideSoftInputFromWindow(mainLayout.getWindowToken(), 0);            if (comET.getEdit().getText().toString().trim().equals(""))                comET.getEdit().setText(String.valueOf(0));            else if (fundET.getEdit().getText().toString().trim().equals(""))                fundET.getEdit().setText(String.valueOf(0));            return false;        }    };    @Override    protected void onCreate(Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        getWindow().setStatusBarColor(getResources().getColor(R.color.titile_bg_color));        setContentView(R.layout.activity_main);        initView();        initListener();    }    private void initView() {        morTypeSelector = (SelectorView) findViewById(R.id.mortgage_type);        repayTypeSelector = (SelectorView) findViewById(R.id.repayment_type);        comET = (UnitEditText) findViewById(R.id.commercial_et);        fundET = (UnitEditText) findViewById(R.id.provident_fund_et);        mortgageTime = (TextView) findViewById(R.id.mortgage_time);        timeSeek = (SeekBar) findViewById(R.id.time_seek);        comRateResult = (TextView) findViewById(R.id.com_rate_result);        fundRateResult = (TextView) findViewById(R.id.fund_rate_result);        calculator = (Button) findViewById(R.id.calculator);        mainLayout = (LinearLayout) findViewById(R.id.main_layout);        commercialStandardRateView = (TextView) findViewById(R.id.commercial_standard_rate);        fundStandardRateView = (TextView) findViewById(R.id.fund_standard_rate);        history = (ImageView) findViewById(R.id.history);        pickDialog = (PickDialog) findViewById(R.id.pick_dialog);        comRatePicker = (LinearLayout) findViewById(R.id.com_rate_picker);        fundRatePicker = (LinearLayout) findViewById(R.id.fund_rate_picker);        final String commercialStandardRate = String.format(Locale.CHINA,                "<font color=\"#bbc5d4\">%s</font><font color=\"#3eb0ee\">%s</font>",                "商业 ", "4.90%");        final String fundStandardRate = String.format(Locale.CHINA,                "<font color=\"#bbc5d4\">%s</font><font color=\"#3eb0ee\">%s</font>",                "公积金 ", "3.25%");        commercialStandardRateView.setText(Html.fromHtml(commercialStandardRate));        fundStandardRateView.setText(Html.fromHtml(fundStandardRate));    }    private void initListener() {        comET.setOnTouchListener(new View.OnTouchListener() {            @Override            public boolean onTouch(View view,MotionEvent motionEvent) {                pickDialog.setVisibility(View.GONE);                return false;            }        });        fundET.setOnTouchListener(new View.OnTouchListener() {            @Override            public boolean onTouch(View view,MotionEvent motionEvent) {                pickDialog.setVisibility(View.GONE);                return false;            }        });        timeSeek.setOnSeekBarChangeListener(new SeekBar.OnSeekBarChangeListener() {            @Override            public void onProgressChanged(SeekBar seekBar, int i, boolean b) {                mortgageTime.setText((i + 1) + "");            }            @Override            public void onStartTrackingTouch(SeekBar seekBar) {            }            @Override            public void onStopTrackingTouch(SeekBar seekBar) {            }        });        morTypeSelector.setSelectorCallback(morCallback);        repayTypeSelector.setSelectorCallback(repayCallback);        calculator.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                if (pickDialog.getVisibility()==View.VISIBLE)                    return;                mortgageData.setRepayment((timeSeek.getProgress() + 1) * 12);                switch (mortgageData.getMorType()) {                    case MortgageData.MORTGAGE_FUND:                        mortgageData.setComLoan(0);                        mortgageData.setFundLoan(Double.valueOf(comET.getEdit().getText().toString().trim()));                        mortgageData.setComRate(0);                        mortgageData.setFundRate(fundRate);                        break;                    case MortgageData.MORTGAGE_COMMERCIAL:                        mortgageData.setComLoan(Double.valueOf(fundET.getEdit().getText().toString().trim()));                        mortgageData.setFundLoan(0);                        mortgageData.setComRate(comRate);                        mortgageData.setFundRate(0);                        break;                    case MortgageData.MORTGAGE_COMPOSE:                        mortgageData.setComLoan(Double.valueOf(comET.getEdit().getText().toString().trim()));                        mortgageData.setFundLoan(Double.valueOf(fundET.getEdit().getText().toString().trim()));                        mortgageData.setComRate(comRate);                        mortgageData.setFundRate(fundRate);                        break;                }                MorHistoryDataDao morHistoryDataDao = SharedObjects.INSTANCES.getDaoSession().getMorHistoryDataDao();                MorHistoryData morHistoryData = new MorHistoryData(SystemClock.currentThreadTimeMillis(),                        mortgageData.getMorType(), mortgageData.getRepayType(),mortgageData.getRepayment(),                        mortgageData.getComRate(),mortgageData.getComLoan(),mortgageData.getFundRate(),mortgageData.getFundLoan());                morHistoryDataDao.insert(morHistoryData);                ResultData[][] resultDatas = mortgageData.calculator();                Intent intent = new Intent(MortgageActivity.this,MorResultActivity.class);                intent.putExtra(MortgageData.RESULTDATA,resultDatas);                startActivity(intent);            }        });        mainLayout.setOnTouchListener(mainTouchListener);        history.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                pickDialog.hide();                Intent intent = new Intent(MortgageActivity.this,MorHistoryActivity.class);                startActivity(intent);            }        });        pickDialog.setOnPickListener(new PickDialog.OnPickListener() {            @Override            public void OnPick(int pickItem, String callMeId) {                int addition = 100 + (pickItem - 4)*5;                switch (callMeId){                    case "comRatePicker":                        comRateResult.setText(String.valueOf(490*addition/10000f));                        comRate = BASE_COM_RATE * addition / 100;                        comPickItem = pickItem;                        break;                    case "fundRatePicker":                        fundRateResult.setText(String.valueOf(325*addition/10000f));                        fundRate = BASE_FUND_RATE * addition / 100;                        fundPickItem = pickItem;                        break;                }            }        });        comRatePicker.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                if (pickDialog.getVisibility()==View.VISIBLE)                    return;                pickDialog.show(comPickItem,"comRatePicker");            }        });        fundRatePicker.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                if (pickDialog.getVisibility()==View.VISIBLE)                    return;                pickDialog.show(fundPickItem,"fundRatePicker");            }        });        fundRatePicker.setClickable(false);    }    @Override    public void onBackPressed() {        if (pickDialog.getVisibility() == View.VISIBLE)            pickDialog.hide();        else            super.onBackPressed();    }}